{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Hello, {{ username }}</h2>
  <p>Log your daily health metrics:</p>
  <form method="post">
    <label>Sleep hours<input name="sleep" type="number" step="0.1" required></label>
    <label>Calories consumed<input name="food" type="number" step="0.1" required></label>
    <label>Exercise (minutes)<input name="exercise" type="number" step="1" required></label>
    <div class="actions"><button class="btn" type="submit">Add Entry</button></div>
  </form>
</section>

<section class="card">
  <h3>Quick Health Inputs</h3>
  <p class="hint">These are the values the AI model is using to make predictions. Edit them anytime to personalize your risk profile.</p>

  <form action="{{ url_for('profile') }}" method="post">
    <label>Sugar drinks/day<input name="sugar_drinks" type="number" step="0.1" value="{{ predictions_meta.sugar_drinks }}"></label>
    <label>Fruit servings/day<input name="fruit_servings" type="number" step="0.1" value="{{ predictions_meta.fruit_servings }}"></label>
    <label>Vegetable servings/day<input name="veg_servings" type="number" step="0.1" value="{{ predictions_meta.veg_servings }}"></label>
    <label>Stress level (0–10)<input name="stress_level" type="number" step="0.1" value="{{ predictions_meta.stress_level }}"></label>
    <label>Systolic BP<input name="systolic" type="number" step="1" value="{{ predictions_meta.systolic }}"></label>
    <label>Diastolic BP<input name="diastolic" type="number" step="1" value="{{ predictions_meta.diastolic }}"></label>
    <label>Resting HR<input name="resting_hr" type="number" step="1" value="{{ predictions_meta.resting_hr }}"></label>

    <h4>Conditions</h4>
    <label><input type="checkbox" name="existing_diabetes" {% if predictions_meta.existing_diabetes %}checked{% endif %}> Diabetes</label>
    <label><input type="checkbox" name="existing_cvd" {% if predictions_meta.existing_cvd %}checked{% endif %}> Cardiovascular Disease</label>
    <label><input type="checkbox" name="existing_cancer" {% if predictions_meta.existing_cancer %}checked{% endif %}> Cancer</label>
    <label><input type="checkbox" name="existing_asthma" {% if predictions_meta.existing_asthma %}checked{% endif %}> Asthma</label>

    <h4>Family History</h4>
    <label><input type="checkbox" name="family_history_cancer" {% if predictions_meta.family_history_cancer %}checked{% endif %}> Cancer</label>
    <label><input type="checkbox" name="family_history_cvd" {% if predictions_meta.family_history_cvd %}checked{% endif %}> Cardiovascular Disease</label>
    <label><input type="checkbox" name="family_history_diabetes" {% if predictions_meta.family_history_diabetes %}checked{% endif %}> Diabetes</label>

    <div class="actions"><button class="btn" type="submit">Save Changes</button></div>
  </form>
</section>

<section class="card">
  <h3>Risk Predictions</h3>
  {% if not enough_days %}
    <p class="hint">⚠️ Track at least 7 days of data to unlock predictions.</p>
  {% elif predictions %}
    <div class="result-cards">
      {% for disease, p in predictions.items() %}
        <div class="result-card">
          <h4>{{ disease }}</h4>
          <div class="num">{{ p.risk_pct }}%</div>
          <div class="readout">AUC: {{ p.metrics.roc_auc }} | Brier: {{ p.metrics.brier }}</div>
          <div class="readout">Top features:
            <ul>
              {% for feat, imp in p.top_features %}
                <li>{{ feat }} ({{ '%.4f'|format(imp) }})</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No data to display yet.</p>
  {% endif %}
</section>


<section class="card">
  <h3>Your Tracking History</h3>
  {% if chartJSON.dates %}
    <div style="max-width:900px; margin:0 auto;">
      <canvas id="historyChart"></canvas>
    </div>
    <br>
    <div style="max-width:900px; margin:0 auto;">
      <canvas id="lifestyleChart"></canvas>
    </div>
    <script>
      window.__CHART_DATA__ = {
        dates: {{ chartJSON.dates|tojson }},
        sleep: {{ chartJSON.sleep|tojson }},
        food: {{ chartJSON.food|tojson }},
        exercise: {{ chartJSON.exercise|tojson }},
        sugar: {{ chartJSON.sugar|tojson }},
        fruit: {{ chartJSON.fruit|tojson }},
        veg: {{ chartJSON.veg|tojson }},
        stress: {{ chartJSON.stress|tojson }}
      };
    </script>
  {% else %}
    <p>No tracking data yet.</p>
  {% endif %}
</section>

{% endblock %}
